# -----------------------------
# PostgreSQL 16 Configuration
# -----------------------------
#
# Optimized for:
# - PostgreSQL 16
# - 4GB RAM
# - 2 CPUs
# - SSD storage
# - Web database workload (Odoo)

# -----------------------------
# CONNECTIONS AND AUTHENTICATION
# -----------------------------

listen_addresses = '*'
max_connections = 100        # (change requires restart)

# -----------------------------
# MEMORY USAGE
# -----------------------------

# Basic memory settings
shared_buffers = 1GB         # 25% of total memory (4GB)
work_mem = 4MB               # Conservative for 4GB system
maintenance_work_mem = 256MB # For VACUUM, CREATE INDEX etc.
effective_cache_size = 2GB   # 50% of total memory (4GB)
huge_pages = off             # Disabled for small systems

# Dynamic memory
dynamic_shared_memory_type = posix

# -----------------------------
# PARALLEL PROCESSING
# -----------------------------

# Parallel processing for PostgreSQL 16
max_worker_processes = 4
max_parallel_workers = 2       # Limited to number of CPUs
max_parallel_workers_per_gather = 1
max_parallel_maintenance_workers = 1

# -----------------------------
# WRITE-AHEAD LOG (WAL)
# -----------------------------

# WAL settings
checkpoint_completion_target = 0.9
wal_buffers = 16MB
min_wal_size = 1GB
max_wal_size = 4GB

# WAL compression (PostgreSQL 16 optimization)
wal_compression = zstd        # More efficient compression in PostgreSQL 16

# -----------------------------
# PLANNER OPTIMIZATIONS
# -----------------------------

# Planner cost parameters
random_page_cost = 1.1        # Lower for SSDs
effective_io_concurrency = 200 # Higher for SSDs
default_statistics_target = 100

# Modern optimizations
enable_incremental_sort = on  # Improves sort performance (PostgreSQL 16)

# JIT compilation for complex queries
jit = on
jit_above_cost = 100000
jit_inline_above_cost = 500000
jit_optimize_above_cost = 500000

# -----------------------------
# AUTOVACUUM
# -----------------------------

# Autovacuum settings
autovacuum = on
autovacuum_naptime = 1min
autovacuum_max_workers = 2
autovacuum_vacuum_scale_factor = 0.2
autovacuum_analyze_scale_factor = 0.1
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_cost_delay = 20ms
autovacuum_vacuum_cost_limit = 200

# -----------------------------
# TIMEZONE AND LOCALE
# -----------------------------

datestyle = 'iso, mdy'
timezone = 'UTC'
log_timezone = 'UTC'

# Locale settings
lc_messages = 'en_US.utf8'    # Locale for system messages
lc_monetary = 'en_US.utf8'    # Locale for currency formatting
lc_numeric = 'en_US.utf8'     # Locale for number formatting
lc_time = 'en_US.utf8'        # Locale for time formatting
default_text_search_config = 'pg_catalog.english'
