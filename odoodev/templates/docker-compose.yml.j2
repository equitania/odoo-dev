# Docker Compose for Hybrid Odoo {{ version }} Development (dev{{ version }}_native)
# Services only: PostgreSQL (Mailpit optional)
# Odoo runs natively on macOS/Linux with UV virtual environment
# wkhtmltopdf is installed natively (not via Docker)
#
# Usage:
#   docker compose up -d
#   docker compose down
#
# Generated by odoodev

name: ${DEV_USER:-${USER}}-odoo-v{{ version }}-native

services:
  # PostgreSQL Database
  dev-db-{{ version }}-native:
    image: postgres:${POSTGRES_VERSION:-{{ postgres_version }}}
    platform: ${DOCKER_PLATFORM:-linux/arm64}
    environment:
      - POSTGRES_USER=${PGUSER:-ownerp}
      - POSTGRES_PASSWORD=${PGPASSWORD:-CHANGE_AT_FIRST}
      - POSTGRES_DB=postgres
    volumes:
      - ./postgresql.conf:/etc/postgresql/postgresql.conf
      - vol-dev-db-{{ version }}-native:/var/lib/postgresql/data/
    command: postgres -c 'config_file=/etc/postgresql/postgresql.conf'
    shm_size: 1gb
    ports:
      - "${DB_PORT:-{{ db_port }}}:5432"
    networks:
      - native-services-network
    restart: unless-stopped
    container_name: ${DEV_USER:-${USER}}-dev-db-{{ version }}-native
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ownerp"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Mailpit for Email Testing (optional - uncomment if needed)
  # mailpit-{{ version }}-native:
  #   image: axllent/mailpit:${MAILPIT_VERSION:-latest}
  #   platform: ${DOCKER_PLATFORM:-linux/arm64}
  #   environment:
  #     MP_POP3_AUTH: "odoo:odoo"
  #   restart: unless-stopped
  #   networks:
  #     - native-services-network
  #   ports:
  #     - "${MAILPIT_PORT:-{{ mailpit_port }}}:8025"
  #     - "${MAILPIT_SMTP_PORT:-{{ smtp_port }}}:1025"
  #   container_name: ${DEV_USER:-${USER}}-mailpit-{{ version }}-native
  #   healthcheck:
  #     test: ["CMD", "wget", "-q", "--spider", "http://localhost:8025"]
  #     interval: 30s
  #     timeout: 10s
  #     retries: 3

  # NOTE: wkhtmltopdf is installed NATIVELY on the host system
  # macOS: sudo installer -pkg wkhtmltox-*.pkg -target /
  # Path: /usr/local/bin/wkhtmltopdf

volumes:
  vol-dev-db-{{ version }}-native:
    name: ${DEV_USER:-${USER}}-vol-dev-db-{{ version }}-native

networks:
  native-services-network:
    driver: bridge
    name: ${DEV_USER:-${USER}}-native-v{{ version }}-services-network
